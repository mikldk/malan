<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Case study: Partial profiles • malan</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Case study: Partial profiles">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">malan</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.1.9001</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/case-study-partial.html">Case study: Partial profiles</a>
    </li>
    <li>
      <a href="../articles/introduction.html">Introduction</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Case study: Partial profiles</h1>
                        <h4 class="author">Mikkel Meyer Andersen</h4>
            
            <h4 class="date">05 marts, 2019</h4>
      
      
      <div class="hidden name"><code>case-study-partial.Rmd</code></div>

    </div>

    
    
<p>First, the library is loaded:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(malan)</code></pre></div>
<p>For reproducibility, the seed for the (pseudo) random number generator is set:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Random">set.seed</a></span>(<span class="dv">1</span>)</code></pre></div>
<div id="population-simulation" class="section level1">
<h1 class="hasAnchor">
<a href="#population-simulation" class="anchor"></a>Population simulation</h1>
<p>First, the population sizes are determined:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">population_sizes &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Round">round</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="dv">100</span>, <span class="dv">10</span>), <span class="dv">100</span><span class="op">*</span><span class="fl">1.02</span><span class="op">^</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>)))
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(population_sizes, <span class="dt">type =</span> <span class="st">"b"</span>)</code></pre></div>
<p><img src="case-study-partial_files/figure-html/unnamed-chunk-4-1.png" width="672"></p>
<p>A population can be simulated (hiding progress information) as follows:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Random">set.seed</a></span>(<span class="dv">1</span>) <span class="co"># For reproducibility</span>
sim_res_growth &lt;-<span class="st"> </span><span class="kw"><a href="../reference/sample_geneology_varying_size.html">sample_geneology_varying_size</a></span>(
  <span class="dt">population_sizes =</span> population_sizes, 
  
  <span class="co"># VRS = 0.2:</span>
  <span class="dt">enable_gamma_variance_extension =</span> <span class="ot">TRUE</span>,
  <span class="dt">gamma_parameter_shape =</span> <span class="dv">5</span>,
  <span class="dt">gamma_parameter_scale =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">5</span>,
  
  <span class="co"># Live population: </span>
  <span class="co"># 3 generations</span>
  <span class="dt">generations_full =</span> <span class="dv">3</span>, 
  <span class="dt">generations_return =</span> <span class="dv">3</span>,
  
  <span class="dt">progress =</span> <span class="ot">FALSE</span>)</code></pre></div>
<p>Live population:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">live_pop &lt;-<span class="st"> </span>sim_res_growth<span class="op">$</span>individuals_generations</code></pre></div>
<div id="building-the-pedigrees" class="section level2">
<h2 class="hasAnchor">
<a href="#building-the-pedigrees" class="anchor"></a>Building the pedigrees</h2>
<p>Until pedigrees are build/infered, there is not much information available (e.g. about children). So let us infer the pedigrees:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pedigrees &lt;-<span class="st"> </span><span class="kw"><a href="../reference/build_pedigrees.html">build_pedigrees</a></span>(sim_res_growth<span class="op">$</span>population, <span class="dt">progress =</span> <span class="ot">FALSE</span>)
pedigrees</code></pre></div>
<pre><code>## List of 11 pedigrees (of size 217, 96, 95, 56, 51, 47, ...)</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/pedigrees_count.html">pedigrees_count</a></span>(pedigrees)</code></pre></div>
<pre><code>## [1] 11</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/pedigrees_table.html">pedigrees_table</a></span>(pedigrees)</code></pre></div>
<pre><code>##  33  37  21  38  96  47 217  39  56  95  51 
##   1   1   1   1   1   1   1   1   1   1   1</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/pedigree_size.html">pedigree_size</a></span>(pedigrees[[<span class="dv">1</span>]])</code></pre></div>
<pre><code>## [1] 217</code></pre>
<p>We can look at the population as a (tidy)graph:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">g &lt;-<span class="st"> </span><span class="kw">as_tbl_graph</span>(pedigrees)
g</code></pre></div>
<pre><code>## # A tbl_graph: 730 nodes and 719 edges
## #
## # A rooted forest with 11 trees
## #
## # Node Data: 730 x 4 (active)
##   name  gens_from_final ped_id haplotype
##   &lt;chr&gt;           &lt;int&gt;  &lt;int&gt; &lt;list&gt;   
## 1 727                19      4 &lt;int [0]&gt;
## 2 713                18      4 &lt;int [0]&gt;
## 3 704                17      4 &lt;int [0]&gt;
## 4 688                16      4 &lt;int [0]&gt;
## 5 685                15      4 &lt;int [0]&gt;
## 6 673                14      4 &lt;int [0]&gt;
## # … with 724 more rows
## #
## # Edge Data: 719 x 2
##    from    to
##   &lt;int&gt; &lt;int&gt;
## 1     1     2
## 2     2     3
## 3     3     4
## # … with 716 more rows</code></pre>
<p>This can be plotted:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="cf">if</span> (<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/ns-load">requireNamespace</a></span>(<span class="st">"ggraph"</span>, <span class="dt">quietly =</span> <span class="ot">TRUE</span>)) {
  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(ggraph)
  p &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggraph/topics/ggraph">ggraph</a></span>(g, <span class="dt">layout =</span> <span class="st">'tree'</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggraph/topics/geom_edge_link">geom_edge_link</a></span>() <span class="op">+</span>
<span class="st">    </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggraph/topics/geom_node_point">geom_node_point</a></span>(<span class="dt">size =</span> <span class="dv">8</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggraph/topics/geom_node_text">geom_node_text</a></span>(<span class="kw">aes</span>(<span class="dt">label =</span> name), <span class="dt">color =</span> <span class="st">"white"</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggraph/topics/facet_nodes">facet_nodes</a></span>(<span class="op">~</span><span class="st"> </span>ped_id) <span class="op">+</span>
<span class="st">    </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggraph/topics/theme_graph">theme_graph</a></span>() 
  
  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(p)
}</code></pre></div>
<pre><code>## Indlæser krævet pakke: ggplot2</code></pre>
<p><img src="case-study-partial_files/figure-html/unnamed-chunk-9-1.png" width="672"></p>
<p>This is rather difficult to make any sense of. Let’s instead plot only pedigree 1:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">PED_ID &lt;-<span class="st"> </span><span class="dv">1</span>

g_ped2 &lt;-<span class="st"> </span>g <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">activate</span>(nodes) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/filter">filter</a></span>(ped_id <span class="op">==</span><span class="st"> </span>PED_ID)

<span class="cf">if</span> (<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/ns-load">requireNamespace</a></span>(<span class="st">"ggraph"</span>, <span class="dt">quietly =</span> <span class="ot">TRUE</span>)) {
  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(ggraph)
  p &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggraph/topics/ggraph">ggraph</a></span>(g_ped2, <span class="dt">layout =</span> <span class="st">'tree'</span>) <span class="op">+</span>
<span class="st">      </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggraph/topics/geom_edge_link">geom_edge_link</a></span>() <span class="op">+</span>
<span class="st">      </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggraph/topics/geom_node_point">geom_node_point</a></span>(<span class="dt">size =</span> <span class="dv">8</span>) <span class="op">+</span>
<span class="st">      </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggraph/topics/geom_node_text">geom_node_text</a></span>(<span class="kw">aes</span>(<span class="dt">label =</span> name), <span class="dt">color =</span> <span class="st">"white"</span>) <span class="op">+</span>
<span class="st">      </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggraph/topics/theme_graph">theme_graph</a></span>() 
  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(p)
}</code></pre></div>
<p><img src="case-study-partial_files/figure-html/unnamed-chunk-10-1.png" width="672"></p>
</div>
<div id="run-a-mutation-process" class="section level2">
<h2 class="hasAnchor">
<a href="#run-a-mutation-process" class="anchor"></a>Run a mutation process</h2>
<p>Up until now, only the genealogy has been simulated. Now, we run a mutational process, i.e. assign haplotypes to founders and let haplotypes flow down the individuals.</p>
<p>We use realistic data. In the package, there is information about the individual markers:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ystr_markers</code></pre></div>
<pre><code>## # A tibble: 29 x 5
##    Marker  Mutations Meioses  MutProb Alleles   
##    &lt;fct&gt;       &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt; &lt;list&gt;    
##  1 DYS438          4   10673 0.000375 &lt;dbl [22]&gt;
##  2 DYS392          8   15418 0.000519 &lt;dbl [22]&gt;
##  3 DYS393         15   14264 0.00105  &lt;dbl [17]&gt;
##  4 DYS437         13   10652 0.00122  &lt;dbl [15]&gt;
##  5 DYS385a        32   26171 0.00122  &lt;dbl [52]&gt;
##  6 DYS385b        32   26171 0.00122  &lt;dbl [52]&gt;
##  7 DYS643          3    2220 0.00135  &lt;dbl [17]&gt;
##  8 DYS448         11    7229 0.00152  &lt;dbl [36]&gt;
##  9 DYS390         33   15612 0.00211  &lt;dbl [19]&gt;
## 10 DYS19          36   16090 0.00224  &lt;dbl [19]&gt;
## # … with 19 more rows</code></pre>
<p>Note, that <code>MutProb</code> is the point estimate given by <code>MutProb = Mutations / Meioses</code>. Information about which markers that are in which kit is also provided:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ystr_kits</code></pre></div>
<pre><code>## # A tibble: 88 x 2
##    Marker   Kit        
##    &lt;fct&gt;    &lt;fct&gt;      
##  1 DYS392   Minimal    
##  2 DYS393   Minimal    
##  3 DYS385a  Minimal    
##  4 DYS385b  Minimal    
##  5 DYS390   Minimal    
##  6 DYS19    Minimal    
##  7 DYS391   Minimal    
##  8 DYS389I  Minimal    
##  9 DYS389II Minimal    
## 10 DYS438   PowerPlex Y
## # … with 78 more rows</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ystr_kits <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">count</span>(Kit)</code></pre></div>
<pre><code>## # A tibble: 5 x 2
##   Kit               n
##   &lt;fct&gt;         &lt;int&gt;
## 1 Minimal           9
## 2 PowerPlex Y      12
## 3 Yfiler           17
## 4 PowerPlex Y23    23
## 5 Yfiler Plus      27</code></pre>
<p>Let us take all PowerPlex Y23 markers and assume that we only have a partial profile where <code>DYS437</code> and <code>DYS448</code> dropped out. At the same time, we also filter out the integer alleles (for generating random founder haplotypes in a minute):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">partial_kit &lt;-<span class="st"> </span>ystr_kits <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/filter">filter</a></span>(Kit <span class="op">==</span><span class="st"> "PowerPlex Y23"</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">inner_join</span>(ystr_markers, <span class="dt">by =</span> <span class="st">"Marker"</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/filter">filter</a></span>(<span class="op">!</span>(Marker <span class="op">%in%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"DYS437"</span>, <span class="st">"DYS448"</span>))) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">rowwise</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># To work on each row</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">IntegerAlleles =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(Alleles[Alleles <span class="op">==</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Round">round</a></span>(Alleles)]),
         <span class="dt">MinIntAllele =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Extremes">min</a></span>(IntegerAlleles),
         <span class="dt">MaxIntAllele =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Extremes">max</a></span>(IntegerAlleles)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>Kit, <span class="op">-</span>Alleles)
partial_kit</code></pre></div>
<pre><code>## # A tibble: 21 x 7
##    Marker Mutations Meioses MutProb IntegerAlleles MinIntAllele
##    &lt;fct&gt;      &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;list&gt;                &lt;dbl&gt;
##  1 DYS438         4   10673 3.75e-4 &lt;dbl [14]&gt;                5
##  2 DYS392         8   15418 5.19e-4 &lt;dbl [14]&gt;                6
##  3 DYS393        15   14264 1.05e-3 &lt;dbl [12]&gt;                7
##  4 DYS38…        32   26171 1.22e-3 &lt;dbl [23]&gt;                6
##  5 DYS38…        32   26171 1.22e-3 &lt;dbl [23]&gt;                6
##  6 DYS643         3    2220 1.35e-3 &lt;dbl [13]&gt;                4
##  7 DYS390        33   15612 2.11e-3 &lt;dbl [14]&gt;               17
##  8 DYS19         36   16090 2.24e-3 &lt;dbl [12]&gt;                9
##  9 DYS391        38   15486 2.45e-3 &lt;dbl [12]&gt;                5
## 10 DYS38…        42   14339 2.93e-3 &lt;dbl [9]&gt;                 9
## # … with 11 more rows, and 1 more variable: MaxIntAllele &lt;dbl&gt;</code></pre>
<p>This “partial kit” has the following mutation probabilities:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mu &lt;-<span class="st"> </span>partial_kit <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">pull</span>(MutProb)
mu</code></pre></div>
<pre><code>##  [1] 0.0003747775 0.0005188740 0.0010515984 0.0012227274 0.0012227274
##  [6] 0.0013513514 0.0021137586 0.0022374145 0.0024538293 0.0029290746
## [11] 0.0030266344 0.0036747818 0.0037541061 0.0041229909 0.0042882833
## [16] 0.0043338286 0.0050205386 0.0054475439 0.0063641395 0.0133475707
## [21] 0.0147194112</code></pre>
<p>We can make a founder haplotype generator as follows (sampling alleles randomly is not how Y-STR works, but it may work fine for founder haplotypes):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">generate_random_haplotype &lt;-<span class="st"> </span><span class="cf">function</span>() {
  partial_kit <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">rowwise</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">Allele =</span> IntegerAlleles[<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sample">sample.int</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(IntegerAlleles), <span class="dv">1</span>)]) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">pull</span>(Allele)
}</code></pre></div>
<p>Now, a new haplotype is created everytime the function is called (with no arguments):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">generate_random_haplotype</span>()</code></pre></div>
<pre><code>##  [1] 15  7 10  6 15 14 23 18  5 12 15 10 15 36 11 13 19  6 14 23 21</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">generate_random_haplotype</span>()</code></pre></div>
<pre><code>##  [1] 14  7 17  9 10  7 17 17 14 12 20  9 10 36 23 29 33 14 20 11 20</code></pre>
<p>Of course such generator can also be created for a reference database with Y-STR profiles.</p>
<p>Now, we are ready to assign haplotypes to the genealogy:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Random">set.seed</a></span>(<span class="dv">1</span>)
<span class="kw"><a href="../reference/pedigrees_all_populate_haplotypes_custom_founders.html">pedigrees_all_populate_haplotypes_custom_founders</a></span>(
  <span class="dt">pedigrees =</span> pedigrees, 
  <span class="dt">get_founder_haplotype =</span> generate_random_haplotype,
  <span class="dt">mutation_rates =</span> mu,
  <span class="dt">progress =</span> <span class="ot">FALSE</span>)</code></pre></div>
<p>We can now plot pedigrees with haplotype information (note that <code>as_tbl_graph</code> needs to be called again):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">g_ped2 &lt;-<span class="st"> </span><span class="kw">as_tbl_graph</span>(pedigrees) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">activate</span>(nodes) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/filter">filter</a></span>(ped_id <span class="op">==</span><span class="st"> </span>PED_ID) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(name) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">haplotype_str =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste0</a></span>(haplotype[[<span class="dv">1</span>]], <span class="dt">collapse =</span> <span class="st">";"</span>))
  <span class="co">#mutate(haplotype_str = map(haplotype, paste0, collapse = ";")[[1]])</span>

<span class="cf">if</span> (<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/ns-load">requireNamespace</a></span>(<span class="st">"ggraph"</span>, <span class="dt">quietly =</span> <span class="ot">TRUE</span>)) {
  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(ggraph)
  p &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggraph/topics/ggraph">ggraph</a></span>(g_ped2, <span class="dt">layout =</span> <span class="st">'tree'</span>) <span class="op">+</span>
<span class="st">      </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggraph/topics/geom_edge_link">geom_edge_link</a></span>() <span class="op">+</span>
<span class="st">      </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggraph/topics/geom_node_point">geom_node_point</a></span>(<span class="kw">aes</span>(<span class="dt">color =</span> haplotype_str), <span class="dt">size =</span> <span class="dv">8</span>) <span class="op">+</span>
<span class="st">      </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggraph/topics/geom_node_text">geom_node_text</a></span>(<span class="kw">aes</span>(<span class="dt">label =</span> name), <span class="dt">color =</span> <span class="st">"white"</span>) <span class="op">+</span>
<span class="st">      </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggraph/topics/theme_graph">theme_graph</a></span>() 
  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(p)
}</code></pre></div>
<pre><code>## Ungrouping graph...</code></pre>
<p><img src="case-study-partial_files/figure-html/unnamed-chunk-18-1.png" width="672"></p>
</div>
</div>
<div id="counting-matches" class="section level1">
<h1 class="hasAnchor">
<a href="#counting-matches" class="anchor"></a>Counting matches</h1>
<p>We have <code>live_pop</code> from the population.</p>
<div id="drawing-an-individual-and-counting-matches" class="section level2">
<h2 class="hasAnchor">
<a href="#drawing-an-individual-and-counting-matches" class="anchor"></a>Drawing an individual and counting matches</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Random">set.seed</a></span>(<span class="dv">5</span>)
Q_index &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sample">sample.int</a></span>(<span class="dt">n =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(live_pop), <span class="dt">size =</span> <span class="dv">1</span>)
Q &lt;-<span class="st"> </span>live_pop[[Q_index]]
<span class="kw"><a href="../reference/print_individual.html">print_individual</a></span>(Q)</code></pre></div>
<pre><code>##   pid = 72 with father pid = 178 and no children</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Q_hap &lt;-<span class="st"> </span><span class="kw"><a href="../reference/get_haplotype.html">get_haplotype</a></span>(Q)
Q_hap</code></pre></div>
<pre><code>##  [1] 15 13 13 24  6 11 27 17 10 16 11  9  5 24 13 23 28 10 23 14 17</code></pre>
<p>Now, count matches in live part of pedigree and in live part of population:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Q_ped &lt;-<span class="st"> </span><span class="kw"><a href="../reference/get_pedigree_from_individual.html">get_pedigree_from_individual</a></span>(Q)
ped_live_matches &lt;-<span class="st"> </span><span class="kw"><a href="../reference/count_haplotype_occurrences_pedigree.html">count_haplotype_occurrences_pedigree</a></span>(
  <span class="dt">pedigree =</span> Q_ped, 
  <span class="dt">haplotype =</span> Q_hap, 
  <span class="dt">generation_upper_bound_in_result =</span> <span class="dv">2</span>) <span class="co"># gen 0, 1, 2</span>
pop_live_matches &lt;-<span class="st"> </span><span class="kw"><a href="../reference/count_haplotype_occurrences_individuals.html">count_haplotype_occurrences_individuals</a></span>(
  <span class="dt">individuals =</span> live_pop, 
  <span class="dt">haplotype =</span> Q_hap)

ped_live_matches</code></pre></div>
<pre><code>## [1] 41</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pop_live_matches</code></pre></div>
<pre><code>## [1] 41</code></pre>
<p>We can also inspect pedigree matches information about number of meioses and <span class="math inline">\(L_1\)</span> distances:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">path_details &lt;-<span class="st"> </span><span class="kw"><a href="../reference/pedigree_haplotype_matches_in_pedigree_meiosis_L1_dists.html">pedigree_haplotype_matches_in_pedigree_meiosis_L1_dists</a></span>(
  <span class="dt">suspect =</span> Q, 
  <span class="dt">generation_upper_bound_in_result =</span> <span class="dv">2</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">nrow</a></span>(path_details)</code></pre></div>
<pre><code>## [1] 41</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(path_details)</code></pre></div>
<pre><code>##      meioses max_L1 pid
## [1,]       4      0 300
## [2,]       5      0 181
## [3,]       6      0  80
## [4,]       6      0  94
## [5,]       6      0  98
## [6,]       6      0 120</code></pre>
<p>This can of course be repeated to many populations (genealogies, haplotype processes, suspects etc.). Also note that variability can be put on mutation rates, e.g. by a Bayesian approach.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li>
<a href="#population-simulation">Population simulation</a><ul class="nav nav-pills nav-stacked">
<li><a href="#building-the-pedigrees">Building the pedigrees</a></li>
      <li><a href="#run-a-mutation-process">Run a mutation process</a></li>
      </ul>
</li>
      <li>
<a href="#counting-matches">Counting matches</a><ul class="nav nav-pills nav-stacked">
<li><a href="#drawing-an-individual-and-counting-matches">Drawing an individual and counting matches</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Mikkel Meyer Andersen.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
